<!doctype html>
<html lang="en" xmlns:ng="http://angularjs.org" ng-app="tinkrbell">
  <head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">

  <title>tinkrbell : Image previewer</title>
	<!--[if lte IE 7]>
	  <script src="//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css">

	<style type="text/css">
	body {
		padding-top: 20px;

    background-color: #232353;
    background-image: linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
    /*height: 100%;*/
    background-size: 50px 50px;
	}
	</style>
  </head>

  <body ng-controller="IconController">
	<div class="container">
		<div class="row">
			<div class="col-sm-10 col-sm-offset-1">
				<form class="form-inline" role="form">
					<div class="form-group col-sm-6 col-md-6 col-md-offset-1">
						<input class="form-control" placeholder="Enter a image URL" ng-model="src" style="width: 100%;" />
          </div>
          <div class="form-group col-sm-3 col-md-2">
            <div class="input-group">
              <input type="number" class="form-control" ng-model="_width" placeholder="width" />
              <div class="input-group-addon">px</div>
            </div>
          </div>
          <div class="form-group col-sm-3 col-md-2">
            <div class="input-group">
              <input type="number" class="form-control" ng-model="_height" placeholder="height" />
              <div class="input-group-addon">px</div>
            </div>
          </div>
				</form>

        <div class="row" style="text-align: center;" ng-if="uri">
          <a ng-attr-href="{{ url_for('preview', {uri: uri, width: width, height: height}) }}">
            <small>{{ url_for('preview', {uri: uri, width: width, height: height}) }}</small>
          </a>
        </div>
			</div>
		</div>
	</div>

  <br><br>

	<div class="container-fluid">
		<div class="row">
      <div class="col-sm-12">
        <div style="border: 1px dashed white; margin: 0 auto; box-sizing: content-box;" ng-style="{width: width + 'px', height: height + 'px'}">
          <img id="preview" ng-src="{{ url_for('preview', {uri: uri, width: width, height: height}) }}" />
        </div>
      </div>
    </div>
	</div>

  <footer>
  </footer>

  <!-- Javascript -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.6/angular.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.6/angular-cookies.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/favico.js/0.3.4/favico.min.js"></script>

	<script type="text/javascript">
	  angular.module('ngUnderscore', [])
		  .factory('_', function () {
  		  return window._;
      })
	  ;
	</script>

	<script type="text/javascript">
    // $(function () {
      // $('[data-toggle="tooltip"]').tooltip();
    // });

	  angular.module('tinkrbell', ['ngUnderscore', 'ngCookies'])
  		.factory('url_for', ['$location', '$log', '_', function ($location, $log, _) {
        var API_ENDPOINT = (function (endpoint) {
            if(endpoint.substr(-1) == '/') {
              endpoint = endpoint.substr(0, endpoint.length - 1);
            }
            $log.info('Using API Endpoint:', endpoint);
            return endpoint;
        })($location.search().api || '');

  			var urlconf = {
          'preview': '/1/preview/%(width)sx%(height)s/%(uri)s'
  			};
  			return function (endpoint, kwargs) {
  				return API_ENDPOINT + _.str.sprintf(urlconf[endpoint], kwargs);
  			};
  		}])
  		.controller('IconController', ['$scope', '$log', '$cookies', '_', 'url_for', function ($scope, $log, $cookies, _, url_for) {
        $scope.url_for = url_for;
        $scope._width = 512;
        $scope._height = 512;

        $scope.$watch('src', _.debounce(function (value) {
          $scope.$apply(function () {
            if (!value || !$scope.width || !$scope.height) return;
            $scope.uri = value;
          });
        }, 500));

        $scope.$watch('uri', function (value, oValue) {
          $cookies.uri = value;
        });

        $scope.$watch('_width', _.debounce(function (value) {
          $scope.$apply(function () {
            $scope.width = value;
          });
        }, 300));

        $scope.$watch('_height', _.debounce(function (value) {
          $scope.$apply(function () {
            $scope.height = value;
          });
        }, 300));

        $scope.src = $cookies.uri;
  		}])
	  ;
	</script>
  </body>
</html>
