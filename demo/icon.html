<!doctype html>
<html lang="en" xmlns:ng="http://angularjs.org" ng-app="tinkrbell">
  <head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">

  <title>tinkrbell : Icon generator</title>
	<!--[if lte IE 7]>
	  <script src="//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css">

	<style type="text/css">
	body {
    color: white;
		padding-top: 20px;
    background-color: #232353;
    background-image: linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
    height: 100%;
    background-size: 50px 50px;
	}
  img {
    border: 1px dashed white;
  }
	</style>
  </head>

  <body ng-controller="IconController">
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-8 col-sm-offset-2">
				<form class="form-inline" role="form">
					<div class="form-group col-sm-12">
						<input class="form-control" placeholder="Enter a media URL" ng-model="src" style="width: 100%;">
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-sm-offset-2" style="text-align: right;">
        <h4>Single sized .ico</h4>
      </div>
      <div class="col-sm-2" style="text-align: center;">
      </div>
      <div class="col-sm-3">
        <h4>Multisized .ico <small class="text-muted">(src: 256px)</small></h4>
      </div>
    </div>

		<div class="row" id="preview" ng-repeat="size in availableSizes">
      <div class="col-sm-3 col-sm-offset-2" style="text-align: right;">
        <img ng-src="{{ url_for('icon', {uri: uri, size: size}) }}" ng-attr-width="{{ size }}" ng-attr-height="{{ size }}" />
        <br>
        <a ng-attr-href="{{ url_for('icon', {uri: uri, size: size}) }}">
          <small class="text-muted">{{ size }} x {{ size }}</small>
        </a>
      </div>
      <div class="col-sm-2" style="text-align: center;">
        <h5>{{ size }} x {{ size }}</h5>
      </div>
      <div class="col-sm-3">
        <img ng-src="{{ url_for('icon_multi', {uri: uri}) }}" ng-attr-width="{{ size }}" ng-attr-height="{{ size }}" />
        <br>
        <a ng-attr-href="{{ url_for('icon_multi', {uri: uri}) }}">
          <small class="text-muted">{{ size }} x {{ size }}</small>
        </a>
      </div>
    </div>
	</div>

  <footer>
  </footer>

  <!-- Javascript -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.6/angular.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/favico.js/0.3.4/favico.min.js"></script>

	<script type="text/javascript">
	  angular.module('ngUnderscore', [])
		.factory('_', function () {
		  return window._;
		})
	  ;
	</script>

	<script type="text/javascript">
	  angular.module('tinkrbell', ['ngUnderscore'])
  		.factory('url_for', ['$location', '$log', '_', function ($location, $log, _) {
        var API_ENDPOINT = (function (endpoint) {
            if(endpoint.substr(-1) == '/') {
              endpoint = endpoint.substr(0, endpoint.length - 1);
            }
            $log.info('Using API Endpoint:', endpoint);
            return endpoint;
        })($location.search().api || '//localhost:8000');

  			var urlconf = {
          'icon': '/1/icon/%(size)s/%(uri)s',
          'icon_multi': '/1/icon/%(uri)s'
  			};
  			return function (endpoint, kwargs) {
  				return API_ENDPOINT + _.str.sprintf(urlconf[endpoint], kwargs);
  			};
  		}])
  		.controller('IconController', ['$scope', '$log', 'url_for', function ($scope, $log, url_for) {
        $scope.url_for = url_for;
        $scope.availableSizes = [16, 32, 48, 256];
        
        $scope.$watch('src', _.debounce(function () {
          $scope.$apply(function () {
            $scope.uri = $scope.src;
          });
        }, 500));
  		}])
	  ;
	</script>
  </body>
</html>
